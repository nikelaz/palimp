import {
    VerticalBox,
    HorizontalBox,
    LineEdit,
    Button,
    StandardTableView,
    Spinner,
} from "std-widgets.slint";

export component QueryResultsPanel inherits Rectangle {
    in property <string> selected-crawl-id;
    in property <[[StandardListViewItem]]> results;
    in property <bool> is-loading: false;
    property <string> css-selector-input: "";
    callback run-query-clicked(string, string);
    callback export-csv-clicked();
    
    VerticalBox {
        padding: 0;
        spacing: 15px;

        HorizontalBox {
            padding: 0;
            spacing: 15px;

            LineEdit {
                horizontal-stretch: 1;
                placeholder-text: "CSS Selector (eg. div.content a)";
                text <=> root.css-selector-input;
                enabled: selected-crawl-id != "";
            }

            Button {
                text: is-loading ? "Running..." : "Run Query";
                enabled: selected-crawl-id != "" && css-selector-input != "" && !is-loading;
                clicked => {
                    root.run-query-clicked(selected-crawl-id, css-selector-input);
                }
            }
            
            Button {
                text: "Export CSV";
                enabled: results.length > 0;
                clicked => {
                    root.export-csv-clicked();
                }
            }
        }
        
        // Loading spinner
        if is-loading: HorizontalBox {
            alignment: center;
            vertical-stretch: 1;
            Spinner {
                indeterminate: true;
                width: 48px;
                height: 48px;
            }
        }
        
        // Results table
        if !is-loading: StandardTableView {
            horizontal-stretch: 1;
            vertical-stretch: 1;
            columns: [{ title: "ID", width: 80px }, { title: "Page URL" }, { title: "Count", width: 80px }];
            rows: root.results;
        }
    }
}
