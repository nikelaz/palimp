import { VerticalBox, HorizontalBox } from "std-widgets.slint";

import { SidebarNav } from "components/sidebar-nav.slint";
import { SitesPage } from "pages/sites-page.slint";
import { CrawlsPage } from "pages/crawls-page.slint";
import { QueriesPage } from "pages/queries-page.slint";
import { ResultsPage } from "pages/results-page.slint";
import { AddSiteDialog } from "components/add-site-dialog.slint";

export { AddSiteDialog }

export component AppWindow inherits Window {
    title: "Palimp GUI";
    width: 800px;
    height: 600px;

    in property <[[StandardListViewItem]]> sites;
    in property <[[StandardListViewItem]]> crawls;
    in property <[[StandardListViewItem]]> queries;
    in property <[[StandardListViewItem]]> results;

    callback request_add_site(string, string);
    callback request_delete_site(string);
    callback request_start_crawl(string, string);
    callback request_delete_crawl(string);
    callback request_add_query(string, string);
    callback request_delete_query(string);
    callback request_load_results(string);
    
    // New callback to signal the Rust backend to open the dialog
    callback open_add_site_dialog();

    // Current active section (0 = Sites, 1 = Crawls, 2 = Queries, 3 = Results)
    property <int> current_section: 0;

    HorizontalBox {
        // Left Sidebar Navigation
        SidebarNav {
            current-section <=> root.current_section;
        }

        // Main Content Area
        VerticalBox { 
            // Sites Page 
            if current_section == 0: SitesPage {
                sites: root.sites;
                request_add_site_dialog() => {
                    root.open_add_site_dialog();
                }
                request_delete_site(id) => {
                    root.request_delete_site(id);
                }
            }

            // Crawls Page
            if current_section == 1: CrawlsPage {
                crawls: root.crawls;
                request_start_crawl(site_id, concurrency) => {
                    root.request_start_crawl(site_id, concurrency);
                }
                request_delete_crawl(id) => {
                    root.request_delete_crawl(id);
                }
            }

            // Queries Page
            if current_section == 2: QueriesPage {
                queries: root.queries;
                request_add_query(crawl_id, selector) => {
                    root.request_add_query(crawl_id, selector);
                }
                request_delete_query(id) => {
                    root.request_delete_query(id);
                }
            }

            // Results Page
            if current_section == 3: ResultsPage {
                results: root.results;
                request_load_results(query_id) => {
                    root.request_load_results(query_id);
                }
            }
        }
    }
}
