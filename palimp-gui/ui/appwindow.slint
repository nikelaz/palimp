import { VerticalBox, HorizontalBox } from "std-widgets.slint";
import { SitesSidebar } from "components/sites-sidebar.slint";
import { SiteDetailPage } from "pages/site-detail-page.slint";
import { AddSiteDialog } from "components/add-site-dialog.slint";
import { AddCrawlDialog } from "components/add-crawl-dialog.slint";

export { AddSiteDialog, AddCrawlDialog }

export component AppWindow inherits Window {
    title: "Palimp GUI";
    min-width: 960px;
    min-height: 540px;

    // Data properties
    in property <[StandardListViewItem]> sites;
    in property <[[StandardListViewItem]]> crawls;
    in property <[[StandardListViewItem]]> results;

    // State properties
    in-out property <string> selected-site-id: "";
    in-out property <int> selected-site-index: -1;
    property <bool> has-sites: sites.length > 0;

    // Callbacks to Rust
    callback open-add-site-dialog();
    callback open-add-crawl-dialog(string);  // site_id
    callback site-selected(int);  // Load crawls for site (now takes index)
    callback request-add-site(string, string);
    callback request-start-crawl(string, string);  // site_id, concurrency
    callback request-delete-crawl(string);
    callback request-run-query(string, string);  // crawl_id, selector
    callback crawl-selected(string);  // Notify Rust of crawl selection for caching

    HorizontalBox {
        padding: 0;
        // Left: Sites Sidebar
        sites-sidebar := SitesSidebar {
            sites: root.sites;
            selected-site-index <=> root.selected-site-index;
            add-site-clicked => {
                root.open-add-site-dialog();
            }
            site-selected(index) => {
                root.site-selected(index);  // Tell Rust to load crawls
              }
        }

        // Right: Main Content Area
        if !has-sites: Text {
            text: "Create a site to begin";
            horizontal-alignment: center;
            vertical-alignment: center;
            font-size: 18px;
            color: #888;
        }

        if has-sites: SiteDetailPage {
            site-id: root.selected-site-id;
            crawls: root.crawls;
            results: root.results;
            add-crawl-clicked => {
                root.open-add-crawl-dialog(root.selected-site-id);
            }
            delete-crawl-clicked(id) => {
                root.request-delete-crawl(id);
            }
            run-query-clicked(crawl-id, selector) => {
                root.request-run-query(crawl-id, selector);
            }
            crawl-selected(id) => {
                root.crawl-selected(id);
            }
        }
    }
}
